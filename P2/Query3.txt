/* 9077738517 */
SELECT INSIDE.SUPPLIERNAME, WITHIN_REGION, OUTSIDE_REGION
FROM
    (SELECT SUPNATION.N_NAME as SUPPLIERNAME, sum(L_QUANTITY * (L_EXTENDEDPRICE - L_DISCOUNT)) as WITHIN_REGION
    FROM
        ((SELECT *
        FROM SUPPLIER, PARTSUPP, LINEITEM, ORDERS, CUSTOMER
        WHERE
            S_SUPPKEY = PS_SUPPKEY AND
            PS_PARTKEY = L_PARTKEY AND
            PS_SUPPKEY = L_SUPPKEY AND
           O_ORDERKEY = L_ORDERKEY AND
            C_CUSTKEY = O_CUSTKEY)
        JOIN NATION SUPNATION on SUPNATION.N_NATIONKEY = S_NATIONKEY
        JOIN NATION CUSTNATION on CUSTNATION.N_NATIONKEY = c_NATIONKEY)
    WHERE SUPNATION.N_REGIONKEY = CUSTNATION.N_REGIONKEY
    GROUP BY SUPNATION.N_NAME) INSIDE,
    (SELECT SUP2NATION.N_NAME as CUSTOMERNAME, sum(L_QUANTITY * (L_EXTENDEDPRICE - L_DISCOUNT)) as OUTSIDE_REGION
    FROM
        ((SELECT *
        FROM SUPPLIER, PARTSUPP, LINEITEM, ORDERS, CUSTOMER
        WHERE
            S_SUPPKEY = PS_SUPPKEY AND
            PS_PARTKEY = L_PARTKEY AND
            PS_SUPPKEY = L_SUPPKEY AND
           O_ORDERKEY = L_ORDERKEY AND
            C_CUSTKEY = O_CUSTKEY)
        JOIN NATION SUP2NATION on SUP2NATION.N_NATIONKEY = S_NATIONKEY
        JOIN NATION CUST2NATION on CUST2NATION.N_NATIONKEY = C_NATIONKEY)
    WHERE SUP2NATION.N_REGIONKEY <> CUST2NATION.N_REGIONKEY
    GROUP BY SUP2NATION.N_NAME) OUTSIDE
WHERE INSIDE.SUPPLIERNAME = OUTSIDE.CUSTOMERNAME
ORDER BY WITHIN_REGION DESC;

